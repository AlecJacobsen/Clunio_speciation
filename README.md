# Code for "Larval Competition for Space can Induce Allochronic Divergence in the Marine Midge, Clunio marinus" 
doi: https://doi.org/10.1101/2025.09.16.676472

`Manuscript_Figures.ipynb` is a jupyter notebook containing all of the code to generate the figures. It can be run using jupyter notebooks, or the code can be copied into a python file to be run as a stand-alone script. This notebook also contains the class used for the ecology model simulations (i.e. without exual reproduction, recombinations, or a genetic basis). Individual runs used for figures 2 and 3 were generated by using this class within the notebook to run the simulations by running
```
sim = ecology_model(sd = 0.25, Cw = 0.1, K = 100, mu = 0.18, N0 = 10, X0 = 15, Y0 = 0, gens = 500)
res, res_y = sim.simulate(return_array = True, return_Y = True, return_N = False)
```
`Sd` corresponds to $\sigma_{dispersal}$, `Cw` is $C_w$, `K` is the carrying capacity, `mu` is the mutation rate, `N0` is the initial population size, `X0` is the initial phenotype of the population, `Y0` is the initial depth of the population, and `gens` is how many generations the simulation will run. `sim.simulate()` will return the number of peaks in the phenotypic distribution at the end of the simulation by default. If `return_array = True`, then it will return the distribution of phenotypes. If `return_array = True` and `return_Y = False`, then it will return both the distrbution of phenotypes and the distribution of individuals over depth. Finally, `return_N = True` returns the population size over the course of the simulation.


!! All `.sbatch` files will have to be modified for use on other computing clusters !! 


`Ecology_model/` subfolders contain the code used to generate figures 3 and S1. These include Python and accomanying Bash scripts which call the Python scripts on a computing cluster using Slurm as a workload manager. 
 - `Fig_3/`
 	- `run_optimized_eco_model.py` executes the simulations for the parameter sweep (figure 3).
 	- `paramSweep.sbatch` runs `run_optimized_eco_model.py` 1000 times, launching no more than 25 jobs at a time (including itself). It outputs files labelled as `{output directory}/rep{replicate}.npy`. Results are output into the `CwSd_paramSweep/` folder. Generating the data for figure 3 can be done by executing `sbatch paramSweep.sbatch` within the `Ecology_model/Fig_3/` directory.
 - `Sup_fig_1/`
	 - `make-pip.py` runs a modified simulation with only a single, pre-specified mutation event in order to calculate pairwise invasibility of two phenotypes. 
	 - `getPIPs.sbatch` runs `make-pip.py` 1000 times for all phenotypes and for three parameter combinations of $C_w$ and $\sigma_{dispersal}$ to generate the data for supplemental figure 1. Output files are labelled `{output directory}/Cw{value}-sd{value}_rep{replicate}.npy`. Results are output into the `pips/` folder. Generating the data for supplemental figure 1 can then be done by executing `sbatch getPIPs.sbatch` within the `Ecology_model/Sup_fig_1/` directory.




`Genetic_model/` subfolders contain the code to simulate the model with sexual reproduction, recombination, and an explicit genetic basis. These folders contain SLiM, Python, and Bash scripts. The SLiM scripts contain the code to run the simulations in SLiM. These SLiM scripts are then called by the python scripts, which specify which parameters are to be used for each simulation and receive/parse the output from SLiM. Lastly, the Bash scripts schedule and manage running the simulations on the computing cluster. SLiM simulations are carried out within a conda environment. This environment can be created by executing `conda env create --name slim --file=SLiM_conda.yml` within the main directory.
 - `Fig_4/`
	- `reduced_model.slim` contains the SLiM script that executes a single simulation, with parameters specified on the command line.
    - `CwSd_ParamSweep.py` calls `reduced_model.slim` to run a parameter sweep over $C_w$ and $\sigma_{dispersal}$.
    - `CwSd_paramSweep.sbatch` launches `CwSd_ParamSweep.py` within slurm jobs, while monitoring how many jobs are running on the cluster. Results will be output into the `CwSd_paramSweep` directory. Generating the data for figure 4 thus requires executing `sbatch CwSd_paramSweep.sbatch` within the `Genetic_model/Fig_4/` directory.
 - `Fig_5/`
    - `reduced_model_OutputsFreqs.slim` contains the SLiM script that runs the simulation, outputting allele frequencies at the end of the simulation instead of phenotypes.
    - `Gen_ParamSweep.py` calls `reduced_model_OutputsFreqs.slim` to run a parameter sweep over the genetic parameters and collects the simulation results.
    - `Gen_paramSweep.sbatch` then launches `Gen_ParamSweep.py` within slurm jobs 1000 times, monitoring how many jobs are running at any one time. Results will be output to the `Gen_paramSweep` directory. Generating the data for figure 5 can be done by exectuing `sbatch Gen_paramSweep.sbatch` within the `Genetic_model/Fig_4/` directory.
 - `Sup_fig_2/`
 - `Sup_fig_3/`
 - `Sup_fig_4/`
  





 
